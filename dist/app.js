!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t){document.addEventListener("click",function(e){var t=e.target;if("tabs"===t.dataset.role){[].forEach.call(t.parentElement.children,function(e){e.classList.remove("active")}),t.classList.add("active");var i=document.querySelector(".".concat(t.dataset.view));i&&([].forEach.call(i.parentElement.children,function(e){e.classList.add("hide")}),i.classList.remove("hide"))}})},function(e,t,i){"use strict";i.r(t);i(0);function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$el=t,this.$input=this.$el.querySelector(".input"),this.$input.addEventListener("keyup",this.onKeyUp.bind(this)),this.$songList=this.$el.querySelector(".searchList"),this.$clear=this.$el.querySelector(".clear"),this.keyword="",this.page=1,this.songs=[],this.prepage=20,this.fetching=!1,this.nomore=!1,this.$clear.addEventListener("click",function(){i.$input.value="",i.reset()}),window.addEventListener("scroll",this.onScroll.bind(this))}var t,i,r;return t=e,(i=[{key:"onScroll",value:function(){this.nomore||this.fetching||document.documentElement.clientHeight+pageYOffset>document.body.scrollHeight-50&&this.search(this.keyword,this.page+1)}},{key:"onKeyUp",value:function(e){var t=e.target.value.trim();t||this.reset(),13===e.keyCode&&this.search(t)}},{key:"reset",value:function(){this.page=1,this.songs=[],this.keyword="",this.$songList.innerHTML=""}},{key:"search",value:function(e,t){var i=this;this.keyword=e,this.fetching=!0,fetch("http://localhost:4000/search?keyword=".concat(this.keyword,"&page=").concat(t||this.page)).then(function(e){return e.json()}).then(function(e){return i.page=e.data.song.curpage,i.nomore=0===e.data.song.curnum,e.data.song.list}).then(function(e){return i.append(e)}).then(function(){return i.fetching=!1})}},{key:"append",value:function(e){var t=e.map(function(e){var t=e.singer.map(function(e){return e.name}).join(" ");return'\n      <a class="songItem" \n      href="#player?artist='.concat(t,"&songid=").concat(e.songmid,"&songname=").concat(e.songname,"&albumin=").concat(e.songmid,"&duration=").concat(e.interval,'">\n        <i class="icon icon-music"></i>\n        <div class="songName" ellipsis>').concat(e.songname,'</div>\n        <div class="songSinger" ellipsis>').concat(t,"</div>\n      </a>")}).join("");this.$songList.insertAdjacentHTML("beforeend",t),this.nomore&&this.$songList.insertAdjacentHTML("beforeend",'<li class="nomore">\n        没有更多了\n       </li>')}}])&&n(t.prototype,i),r&&n(t,r),e}();function s(e){var t,i,n,r,s=[].slice.call(e||document.querySelectorAll(".lazyload"));if("IntersectionObserver"in window){var o=new IntersectionObserver(function(e){e.forEach(function(e){e.intersectionRatio>0&&a(e.target,function(){o.unobserve(e.target)})})},{threshold:.01});s.forEach(function(e){return o.observe(e)})}else{var c=(t=function(){if(0===s.length)return window.removeEventListener("scroll",c);(s=s.filter(function(e){return e.classList.contains("lazyload")})).forEach(function(e){(function(e){var t=e.getBoundingClientRect(),i=t.top,n=t.right,r=t.bottom,s=t.left,a=document.documentElement.clientHeight,o=document.documentElement.clientWidth;return(i>0&&i<a||r>0&&r<a)&&(s>0&&s<o||n>0&&n<o)})(e)&&a(e)})},i=500,function e(){var s=Date.now(),a=s-n;!n||a>=i?(t(),n=s):a<i&&(clearTimeout(r),r=setTimeout(e,i-a))});window.addEventListener("scroll",c),window.dispatchEvent(new Event("scroll"))}}function a(e,t){var i=new Image;i.src=e.dataset.src,i.onload=function(){e.src=i.src,e.classList.remove("lazyload"),"function"==typeof t&&t()}}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$el=t.el,this.slides=t.slides,this.interval=t.interval||3e3,this.index=0,this.renderSlide(),this.start()}var t,i,n;return t=e,(i=[{key:"renderSlide",value:function(){this.$el.innerHTML='<div class="slides" id="slides"></div>',this.$slides=this.$el.firstElementChild,this.$slides.style.width="".concat(100*this.slides.length,"%"),this.$slides.innerHTML=this.slides.map(function(e){return'<div class="slidesItem">\n      <a href="'.concat(e.link,'">\n        <img src="').concat(e.image,'" alt="picture">\n      </a>\n    </div>\n      ')}).join("")}},{key:"start",value:function(){setInterval(this.next.bind(this),this.interval)}},{key:"next",value:function(){if(this.index+=1,this.index>=this.slides.length)return this.index=0,void(this.$slides.style.transform="translateX(0)");var e="-".concat(this.index*(100/this.slides.length),"%");this.$slides.style.transform="translateX(".concat(e,")")}}])&&o(t.prototype,i),n&&o(t,n),e}();function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$el=t}var t,i,n;return t=e,(i=[{key:"launch",value:function(){var e=this;return fetch("http://localhost:4000/").then(function(e){return e.json()}).then(function(t){return e.json=t}).then(function(){return e.render()}),this}},{key:"render",value:function(e){this.renderSlider(this.json.data.slider),this.renderRadio(this.json.data.radioList),this.renderList(this.json.data.songList),s()}},{key:"renderSlider",value:function(e){this.slides=new c({el:this.$el.querySelector(".window"),slides:e.map(function(e){return{link:e.linkUrl,image:e.picUrl}})})}},{key:"renderRadio",value:function(e){this.$el.querySelector(".radio .list").innerHTML=e.map(function(e){return'\n  <div class="listItem">\n  <div class="listMedia">\n    <img class="lazyload" data-src="'.concat(e.picUrl,'" alt="封面">\n    <span class="icon icon-play"></span>\n  </div>\n  <div class="listInfo">').concat(e.Ftitle,"</div>\n  </div>")}).join("")}},{key:"renderList",value:function(e){this.$el.querySelector(".hotList .list").innerHTML=e.map(function(e){return'\n  <div class="listItem">\n  <div class="listMedia">\n    <img class="lazyload" data-src="'.concat(e.picUrl,'" alt="封面">\n    <span class="icon icon-play"></span>\n  </div>\n  <div class="listInfo">').concat(e.songListDesc,'\n  <div class="listAuthor">').concat(e.songListAuthor,"</div>\n  </div>\n  </div>")}).join("")}}])&&l(t.prototype,i),n&&l(t,n),e}();function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$el=t}var t,i,n;return t=e,(i=[{key:"launch",value:function(){var e=this;fetch("http://localhost:4000/top").then(function(e){return e.json()}).then(function(t){return e.render(t.data.topList)})}},{key:"render",value:function(e){var t=this;this.$el.innerHTML=e.map(function(e){return'<div class="listItem">\n<div class="picture" >\n    <img class="lazyload" data-src="'.concat(e.picUrl,'" alt="" style="width:100px;height:100px;">\n  </div>\n  <div class="content">\n    <div class="title">').concat(e.topTitle,"</div>\n    ").concat(t.songList(e.songList),"\n  </div>\n</div>")}).join(""),s(this.$el.querySelectorAll(".lazyload"))}},{key:"songList",value:function(e){return e.map(function(e,t){return"<p>".concat(t+1,'\n    <span class="name">').concat(e.songname,'</span>\n    <span class="singer">- ').concat(e.singername,"</span>\n  </p>\n  ")}).join("")}}])&&h(t.prototype,i),n&&h(t,n),e}();function f(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var v="技术原因，暂不支持",y=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$el=t,this.$el.innerHTML='<ul class="playerLyric"></ul>',this.$lyric=this.$el.querySelector(".playerLyric"),this.index=0,this.$audio=i,this.currentTime=0,this.text=0,this.lyric=[],this.lyricObj={},this.time=0,this.reset(v)}var t,i,n;return t=e,(i=[{key:"restart",value:function(){this.reset(),this.start()}},{key:"start",value:function(){this.timer=setInterval(this.update.bind(this),1e3)}},{key:"pause",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){this.$lyric.innerHTML=this.lyric.map(function(e){return"<li>".concat(e.slice(10),"</li>")}).join("")}},{key:"update",value:function(){if(this.currentTime+=Math.round(this.$audio.currentTime),this.processingData(),this.time=+this.getlyricTime(this.lyricObj),this.index===this.lyric.length-1)return this.reset();for(var e=this.index;e<this.time+1;e++)if(this.lyricObj[e]&&this.currentTime===e){this.$lyric.children[this.index].previousSibling&&this.$lyric.children[this.index].previousSibling.classList.remove("active"),this.$lyric.children[this.index].classList.add("active"),this.index+=1;break}if(this.index){var t=(this.index-4)*this.$lyric.firstChild.offsetHeight;this.$lyric.style.transform="translateY(-".concat(t,"px)")}}},{key:"getlyricTime",value:function(e){var t;for(var i in e)t=i;return t}},{key:"processingData",value:function(){var e=this;this.lyric.map(function(t){return t.replace(/^\[(\d{2}):(\d{2}).\d{2}\](.+)/,function(t,i,n,r){e.lyricObj[60*+i+ +n]=r})})}},{key:"reset",value:function(e){this.pause(),this.index=0,this.currentTime=0,e&&(this.text=this.formatText(e),this.lyric=this.text.match(/^\[\d{2}:\d{2}.\d{2}\](.+)$/gm)||[]),this.lyric.length&&(this.render(),this.$lyric.children[this.index].classList.add("active"))}},{key:"formatText",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t.innerHTML}}])&&f(t.prototype,i),n&&f(t,n),e}();function m(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$el=t,this.currentTime=0,this.duration=i||0,this.progress=0,this.render(),this.$currentTime=this.$el.querySelector(".currentTime"),this.$duration=this.$el.querySelector(".duration"),this.$progress=this.$el.querySelector(".bar"),this.$currentTime.innerText=this.formatTime(this.currentTime),this.$duration.innerText=this.formatTime(this.duration),n&&this.start(),this.reset()}var t,i,n;return t=e,(i=[{key:"start",value:function(){this.timer=setInterval(this.update.bind(this),50)}},{key:"pause",value:function(){clearInterval(this.timer)}},{key:"update",value:function(){this.currentTime+=.05,this.currentTime>this.duration&&this.reset(),this.progress=this.currentTime/this.duration,this.$progress.style.transform="translate(".concat(100*this.progress-100,"%)"),this.$currentTime.innerText=this.formatTime(this.currentTime)}},{key:"reset",value:function(e){this.pause(),this.currentTime=0,this.duration=0,e&&(this.duration=e,this.$duration.innerText=this.formatTime(this.duration))}},{key:"restart",value:function(){this.reset(),this.update(),this.start()}},{key:"render",value:function(){this.$el.innerHTML='<div class="currentTime time"></div>\n    <div class="progress">\n      <div class="bar"></div>\n    </div>\n    <div class="duration time"></div>\n    '}},{key:"formatTime",value:function(e){var t=Math.floor(e/60),i=Math.floor(e%60);return t<10&&(t="0"+t),i<10&&(i="0"+i),"".concat(t,":").concat(i)}}])&&m(t.prototype,i),n&&m(t,n),e}();function g(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$el=t,this.button=this.$el.querySelector(".playerFooter .play"),this.button.addEventListener("click",this),this.createAudio(),this.$audio=document.querySelector("audio"),this.musicLyric=new y(this.$el.querySelector(".playerLyricWrapper"),this.$audio),this.musicProgress=new p(this.$el.querySelector(".progressWrapper"),100,!0)}var t,i,n;return t=e,(i=[{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e,this.$el.querySelector(".playerTitle .name").innerText=e.songname,this.$el.querySelector(".playerTitle .singer").innerText=e.artist,this.musicProgress.reset(e.duration);var t="https://y.gtimg.cn/music/photo_new/T002R150x150M000".concat(this.songid,".jpg?max_age=2592000");this.$el.querySelector(".bg").style.background="url".concat(t),e.songid&&(this.songid=e.songid,this.$audio.src="http://aqqmusic.tc.qq.com/amobile.music.tc.qq.com/C400".concat(this.songid,".m4a?guid=407204717&vkey=9CA4990693C80F81F3BB8034F6D90E8FBC0D3AB44FDF715EE8D5EA85DA2DDBB3F4DAF846F4B4ECD232BC0E238579DA8F04539B82874BB621&uin=0&fromtag=38")),this.show(),this.$audio.play(),this.musicLyric.start(),this.musicProgress.start(),this.button.classList.remove("icon-play"),this.button.classList.add("icon-pause")}},{key:"createAudio",value:function(){var e=this;this.$audio=document.createElement("audio"),this.$audio.addEventListener("ended",function(){e.play(e.options),e.$audio.play(),e.musicLyric.restart(),e.musicProgress.restart()}),document.body.appendChild(this.$audio)}},{key:"handleEvent",value:function(e){var t=e.target;switch(!0){case t.matches(".icon-play"):this.onPlay(e);break;case t.matches(".icon-pause"):this.onPause(e)}}},{key:"onPlay",value:function(e){this.$audio.play(),this.musicLyric.start(),this.musicProgress.start(),e.target.classList.add("icon-pause"),e.target.classList.remove("icon-play")}},{key:"onPause",value:function(e){this.$audio.pause(),this.musicLyric.pause(),this.musicProgress.pause(),e.target.classList.add("icon-play"),e.target.classList.remove("icon-pause")}},{key:"show",value:function(){this.$el.classList.remove("hide")}},{key:"hide",value:function(){this.$el.classList.add("hide")}}])&&g(t.prototype,i),n&&g(t,n),e}(),$=(new d(document.querySelector(".toplistView")).launch(),new u(document.querySelector(".commentView")).launch(),new r(document.querySelector(".searchView")),new b(document.querySelector(".player")));function L(){var e=decodeURIComponent(location.hash);if(/^#player\?.+/.test(e)){var t=e.slice(e.indexOf("?")+1).match(/(\w+)=([^&]+)/g),i={};t&&t.map(function(e){var t=e.split("=");i[t[0]]=t[1]});$.play(i)}else $.hide()}document.querySelector(".playerButton").addEventListener("click",function(){document.querySelector(".player").classList.remove("hide")}),document.querySelector(".icon-list").addEventListener("click",function(){document.querySelector(".player").classList.add("hide")}),L(),addEventListener("hashchange",L)}]);